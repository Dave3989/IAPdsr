var iGlobalICode="",iGlobalItem=[];function iGoClicked(){}function iCodeClicked(e,t,n){sGenerateError("<RESET>"),document.getElementById("sitemerror").innerHTML="",document.getElementById("sitemerror").style.display="none";var r=n+"|"+t;"S"==e?iapPrepCall("/Ajax/iapGetDB","I#",r,sProcSetItem):iapPrepCall("/Ajax/iapGetDB","I#",r,sProcGrpItem)}function sProcSetItem(e){if(sClearGroup(),0==e)document.getElementById("setdesc").readOnly=!1,document.getElementById("setcost").readOnly=!1,document.getElementById("setprice").readOnly=!1,document.getElementById("iapNewItem").style.display="inline",sGenerateError("Set Item Code not found! Enter details to add it."),document.getElementById("ADDSETITEM").value="Y",document.getElementById("setdesc").focus();else{if("Y"==e.cat_set)return document.getElementById("sitemerror").innerHTML="Set exists for this item. Use phpMyAdmin",document.getElementById("sitemerror").style.display="inline",void document.getElementById("setitem").focus();"SUPP"==e.SUPPID?document.getElementById("SUPPID").value=e.cat_supplier_id:document.getElementById("SUPPID").value="CO",document.getElementById("setitem").value=e.cat_item_code,document.getElementById("setdesc").value=e.cat_description,document.getElementById("SETITEMCD").value=e.cat_item_code,document.getElementById("SETCOST").value=number_format(e.prc_cost_unit,2,".",""),document.getElementById("SETPRICE").value=number_format(e.prc_price,2,".",""),document.getElementById("setcost").value=number_format(e.prc_cost_unit,2,".",""),document.getElementById("setprice").value=number_format(e.prc_price,2,".",""),document.getElementById("sgrpitem").focus()}return e}function sAddSetItem(){return sGenerateError("<RESET>"),""==document.getElementById("setitem").value&&sGenerateError("Enter an item code then click Add."),"none"==document.getElementById("iapNewItem").style.display&&(document.getElementById("setdesc").readOnly=!1,document.getElementById("setcost").readOnly=!1,document.getElementById("setprice").readOnly=!1,document.getElementById("iapNewItem").style.display="inline"),document.getElementById("ADDSETITEM").value="Y",document.getElementById("sitemitem").focus(),!1}function sSaveSetSupp(){var e=document.getElementById("snewitemsups"),t=e.options[e.selectedIndex].value;return document.getElementById("SUPPID").value=t,!1}function sProcGrpItem(e){return sClearGroup(),0==e?(iGlobalICode=0,document.getElementById("sitemerror").innerHTML="Group Item Code or Description not found.",document.getElementById("sitemerror").style.display="inline",void document.getElementById("sgrpitem").focus()):document.getElementById("SUPPID").value!=e.cat_supplier_id?(document.getElementById("sitemerror").innerHTML="Group Item not same supplier as Set Item",document.getElementById("sitemerror").style.display="inline",void document.getElementById("sgrpitem").focus()):(iGlobalICode=(iGlobalItem=e).cat_item_code,document.getElementById("sgrpitem").value=e.cat_item_code,document.getElementById("sgrpdesc").value=e.cat_description,document.getElementById("GROUPCOST").value=e.prc_cost_unit,document.getElementById("GROUPPRICE").value=e.prc_price,void document.getElementById("sgrpqty").focus())}function sRecordItem(){sGenerateError("<RESET>");var e="N";""==document.getElementById("sgrpitem").value&&(document.getElementById("sgrpitemlbl").style.color="red",sGenerateError("Item Code cannot be blank."),e="Y"),""==document.getElementById("sgrpdesc").value&&(document.getElementById("sgrpdesclbl").style.color="red",sGenerateError("Description cannot be blank."),e="Y"),""==document.getElementById("sgrpqty").value&&(document.getElementById("sgrpqtylbl").style.color="red",sGenerateError("Quantity cannot be blank."),e="Y");var t=parseInt(document.getElementById("sgrpqty").value);if(isNaN(t)&&(document.getElementById("sgrpqtylbl").style.color="red",sGenerateError("Quantity is invalid."),e="Y"),t<0&&(document.getElementById("sgrpqtylbl").style.color="red",sGenerateError("Quantity cannot be negative. Use Returns to bring back an item."),e="Y"),"Y"==e)return sGenerateError("All item fields must be valid prior to clicking Record Item."),!1;document.getElementById("sgrpitemlbl").style.color="#666666",document.getElementById("sgrpdesclbl").style.color="#666666",document.getElementById("sgrpqtylbl").style.color="#666666",sGenerateError("<RESET>");var n=document.getElementById("sgrpitem").value,r=(t=parseInt(document.getElementById("sgrpqty").value),parseFloat(document.getElementById("GROUPCOST").value)),l=parseFloat(t*r),m=parseFloat(document.getElementById("GROUPPRICE").value),o=parseFloat(t*m),d=document.getElementById("iapGroupTbl"),s=d.insertRow(-1),i=s.insertCell(0),c=s.insertCell(1),u=(s.insertCell(2),s.insertCell(3)),a=s.insertCell(4),I=s.insertCell(5),g=s.insertCell(6),E=s.insertCell(7),y=s.insertCell(8),p=s.insertCell(9),B=s.insertCell(10),v=d.rows.length-1;s.setAttribute("id","Grp"+v,0);var T=document.getElementById("STHISITEMSTATUS").value;T=T.substr(0,1),i.innerHTML="<input type='hidden' id='recrow"+v+"' value='"+T+"'>",c.innerHTML="<img src='MyImages/Icons/DeleteRedSM.png' onclick='sDelGrpItem("+v+"); return(false);'>&nbsp;&nbsp;",u.innerHTML=n.toUpperCase(),a.innerHTML=document.getElementById("sgrpdesc").value,I.innerHTML=t,g.innerHTML=number_format(r,2,".",","),E.innerHTML=number_format(l,2,".",","),y.innerHTML=number_format(m,2,".",","),p.innerHTML=number_format(o,2,".",",");var f=document.getElementById("STHISITEMSOURCE").value;B.innerHTML="<input type='hidden' id='recsid"+v+"' value='|"+f+"|'>";var S=parseFloat(document.getElementById("grpcost").value);isNaN(S)&&(S=0),S+=l,document.getElementById("grpcost").value=number_format(S,2,".",",");var b=parseFloat(document.getElementById("grpprice").value);isNaN(b)&&(b=0),b+=o,document.getElementById("grpprice").value=number_format(b,2,".",",");n.toUpperCase(),document.getElementById("STHISITEMSTATUS").value,document.getElementById("STHISITEMSOURCE").value;return sClrGrpData(),document.getElementById("STHISITEMSTATUS").value="",!1}function sDelGrpItem(e){var t="Grp"+e,n=document.getElementById(t),r=n.cells,l=parseFloat(r[6].innerHTML),m=parseFloat(document.getElementById("snetsale").value);return isNaN(m)&&(m=0),m-=l,sShowTotals(m),n.parentNode.removeChild(n),!1}function sClearGroup(){document.getElementById("sgrpitem").value="",document.getElementById("sgrpdesc").value="",document.getElementById("sgrpqty").value="",iGlobalItem=[],document.getElementById("SUPDATETYPE").value="NEW",document.getElementById("GROUPCOST").value="",document.getElementById("GROUPPRICE").value=""}function sClrGrpData(){return sClearGroup(),document.getElementById("sgrpitem").focus(),!1}function sSendForm(){if(""!=document.getElementById("sgrpitem").value||""!=document.getElementById("sgrpdesc").value)return sGenerateError("An Item has not been Recorded. Either click Record Item or clear the data."),document.getElementById("sgrpitem").focus(),!1;for(var e="",t=document.getElementById("iapGroupTbl"),n=1,r=t.rows.length;n<r;n++){for(var l=3,m=t.rows[n].cells.length;l<m-1;l++)e=e+t.rows[n].cells[l].innerHTML+"~";e+="|"}return sD=e.length,document.getElementById("IAPDATA").value=e.substr(0,sD-1),!0}function sGenerateError(e){if("<RESET>"==e)return document.getElementById("sitemerror").innerHTML=" ",void(document.getElementById("sitemerror").style.display="none");var t=document.getElementById("sitemerror").innerHTML;document.getElementById("sitemerror").innerHTML=t+"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+e,document.getElementById("sitemerror").style.display="inline"}$(function(){$("#setitem").autocomplete({source:sItemList,minLength:0,change:function(e,t){if(t.item){var n=t.item.cd;r=t.item.src}else{if(""==(n=document.getElementById("setitem").value))return void sGenerateError("Enter the item code of the set or click Add!");var r=0}iCodeClicked("S",n,r)}}),$("#sgrpitem").autocomplete({source:sItemList,minLength:0,change:function(e,t){if(t.item){var n=t.item.cd;r=t.item.src}else{if(""==(n=document.getElementById("sgrpitem").value))return void sGenerateError("Enter the item code or description of the group item!");var r=0}document.getElementById("sgrpdesc").value="",iCodeClicked("G",n,r)}}),$("#sgrpdesc").autocomplete({source:sDescList,minLength:0,change:function(e,t){if(t.item){var n=t.item.cd;r=t.item.src}else{if(iDescVal=document.getElementById("iDescList").value,""==iDescVal)return void sGenerateError("Enter the item code or description of the group item!");var r=0}document.getElementById("sgrpitem").value="",iCodeClicked("G",n,r)}})});