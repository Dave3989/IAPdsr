var iGlobalICode="",iGlobalItem=[],iGlobalPrices=[],iGlobalPurchases=[],iGlobalSales=[];function iAddClicked(){iClearForm(),document.getElementById("iretire").style.display="none",document.getElementById("icode").focus()}function iGoClicked(){if(iItem=document.getElementById("iItemList").value,""==iItem){if(iDesc=document.getElementById("iDescList").value,""==iDesc)return document.getElementById("iSelError").innerHTML="Enter an item code or description then click Add Item!",void(document.getElementById("iSelError").style.display="inline");iIDescClicked(iDesc,"0")}else iICodeClicked(iItem,"0")}function iICodeClicked(e,t){if("0"==t&&(document.getElementById("iretire").style.display="inline"),""==e)return document.getElementById("iSelError").innerHTML="Enter an item code or description then click Add Item!",void(document.getElementById("iSelError").style.display="inline");document.getElementById("iSelError").style.display="none",document.getElementById("iDescList").value="",igetCatalog("#",e,t),document.getElementById("iItemList").value=""}function iIDescClicked(e,t){if(0==t&&(document.getElementById("iretire").style.display="inline"),""==e)return document.getElementById("iSelError").innerHTML="Enter an item code or description then click Add Item!",void(document.getElementById("iSelError").style.display="inline");document.getElementById("iSelError").style.display="none",document.getElementById("iItemList").value="",igetCatalog("N",e,t),document.getElementById("iDescList").value=""}function igetCatalog(e,t,l){var i="I"+e;iapPrepCall("/Ajax/iapGetDB",i,l+"|"+t,pProcItem);var n=document.getElementById("IAPSUPPID").value;if(0!=iGlobalICode){i="$>";var a=n+"|"+iGlobalICode+"|"+document.getElementById("IAPLODATE").value;iapPrepCall("/Ajax/iapGetDB",i,a,pProcPrices),iShowHistory(t,n)}document.getElementById("idetail").style.display="inline",document.getElementById("iapPrcFldset").style.display="inline",document.getElementById("icode").focus()}function pProcItem(e){if(iClearForm(),0==e)return iGlobalICode=0,document.getElementById("iSelError").innerHTML="Item Code or Description not found. Check it or add as a new item.",document.getElementById("iSelError").style.display="inline",e;iGlobalICode=(iGlobalItem=e).cat_item_code,"Y"==e.cat_active?document.getElementById("iActMsgDiv").style.display="none":(document.getElementById("iActMsgDiv").style.display="inline",document.getElementById("iActMsgDiv").style.color="red"),"SUPP"==e.SUPPID?(document.getElementById("iSuppMsgDiv").style.display="inline",document.getElementById("iSuppMsgDiv").style.color="brown",document.getElementById("iSuppMsgName").innerHTML=e.cat_supplier,document.getElementById("iSuppMsgName").style.color="brown",document.getElementById("iEffDateDiv").style.display="none"):document.getElementById("iSuppMsgDiv").style.display="none",document.getElementById("icode").value=e.cat_item_code,document.getElementById("icode").readOnly=!0,document.getElementById("idesc").value=e.cat_description,document.getElementById("isupplier").value=e.cat_supplier;var t=document.getElementById("iselcat");for(i=0;i<t.length;i++)if(t.options[i].value==e.prc_cat_code){t.options.selectedIndex=i;break}document.getElementById("ionhand").value=e.inv_on_hand,document.getElementById("iminonhand").value=e.inv_min_onhand,document.getElementById("icost").value=e.prc_cost,document.getElementById("iunits").value=e.prc_units,document.getElementById("iprice").value=e.prc_price,document.getElementById("IUPDATETYPE").value="EXISTING",document.getElementById("IITEMCD").value=e.cat_item_code,document.getElementById("idesc").focus();var l=new Date,n=l.getMonth()+1+"/"+l.getDate()+"/"+l.getFullYear();return document.getElementById("ieffdt").value=n,document.getElementById("IAPEFFDT").value=n,"CO"==e.SUPPID?document.getElementById("IAPSUPPID").value=0:document.getElementById("IAPSUPPID").value=e.cat_supplier_id,document.getElementById("IAPCATIMG").value=e.cat_image_file,e.cat_image_file?document.getElementById("iImgBtn").style.display="inline":document.getElementById("iImgBtn").style.display="none","N"==e.cat_active&&(document.getElementById("idesc").readOnly=!0,document.getElementById("isupplier").readOnly=!0,document.getElementById("iselcat").readOnly=!0,document.getElementById("icost").readOnly=!0,document.getElementById("iunits").readOnly=!0,document.getElementById("iprice").readOnly=!0),"SUPP"==e.SUPPID&&(document.getElementById("idesc").readOnly=!0,document.getElementById("isupplier").readOnly=!0,document.getElementById("iselcat").readOnly=!0,document.getElementById("icost").readOnly=!0,document.getElementById("iunits").readOnly=!0,document.getElementById("iprice").readOnly=!0),e}function pProcPrices(e){if(0==(iGlobalPrices=e))return e;var t="",l="Y",n=new Date,a=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear();document.getElementById("ieffdt").value=a,document.getElementById("IAPEFFDT").value=a,document.getElementById("IAPEFFTYPE").value="T";var d=document.getElementById("iapPriceChgs");for(i=0;i<e.length;i++){t=e[i];if("Y"==l){var o=new Date(t.prc_effective);if(o.setDate(o.getDate()+2),n<o){var s=o.getMonth()+1,r=(moment(o).format("MM/DD/YYYY"),s+"/"+o.getDate()+"/"+o.getFullYear());document.getElementById("ieffdt").value=r,document.getElementById("IAPEFFDT").value=r,document.getElementById("IAPEFFTYPE").value="P"}}d.rows.length;var c=d.insertRow(-1);c.setAttribute("id","Item"+i,0),c.setAttribute("class","iapTD1"),c.insertCell(0).innerHTML=" ";var m=c.insertCell(1);m.setAttribute("id","Del"+i,0),m.setAttribute("class","iapTD1"),"Y"==l&&0<e.length&&0==document.getElementById("IAPSUPPID").value?(m.innerHTML="<img src='MyImages/Icons/DeleteRedSM.png' style='height:13px; width:13px;' onclick='pDelSelected("+i+"); return(false);'>",document.getElementById("IPRICEKEY").value=t.prc_item_code+"|"+t.prc_effective_until):m.innerHTML=" ",l="N",c.insertCell(2).innerHTML=" ",c.insertCell(3).innerHTML=moment(t.prc_effective).format("MM/DD/YYYY");var u=c.insertCell(4);u.setAttribute("style","text-align:right;"),pItemCost=parseFloat(t.prc_cost),u.innerHTML=number_format(pItemCost,2,".",",")+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";var y=c.insertCell(5);y.setAttribute("style","text-align:right;"),pItemUnits=parseFloat(t.prc_units),y.innerHTML=number_format(pItemUnits,0,".",",")+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";var p=c.insertCell(6);p.setAttribute("style","text-align:right;"),pItemCostUnit=parseFloat(t.prc_cost_unit),p.innerHTML=number_format(pItemCostUnit,2,".",",")+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";var I=c.insertCell(7);I.setAttribute("style","text-align:right;"),pItemPrice=parseFloat(t.prc_price),I.innerHTML=number_format(pItemPrice,2,".",",")+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",c.insertCell(8).innerHTML=" ",c.insertCell(9).innerHTML="&nbsp;&nbsp;&nbsp;"+t.code_value}0==document.getElementById("IAPSUPPID").value?(document.getElementById("irollback").style.display="inline",document.getElementById("irollbackfill").style.display="inline",document.getElementById("irollbackicon").style.display="inline",document.getElementById("irollbacktxt").style.display="inline"):(document.getElementById("irollback").style.display="none",document.getElementById("irollbackfill").style.display="none",document.getElementById("irollbackicon").style.display="none",document.getElementById("irollbacktxt").style.display="none")}function pDelSelected(e){var t=iGlobalPrices[e],l=document.URL;if(0<=l.toLowerCase().indexOf("litehausconsulting"))var n="iap";else n="itsapartydsr";var a=l.split("/"),d="";for(i=0;i<=a.length;i++){if(0<=(d=a.pop()).toLowerCase().indexOf(n)){a.push(d);var o=a.join("/");break}}var s=o+"/Ajax/iapRollBackPrice.php",r=document.getElementById("LHCA").value,c=t.prc_item_code+"|"+t.prc_effective+"|"+t.prc_effective_until;iapCall(s,"$R",r,c,pProcRollBack);var m=iGlobalPrices[e+1],u=document.getElementById("iselcat");for(i=0;i<u.length;i++)if(u.options[i].value==m.prc_cat_code){u.options.selectedIndex=i;break}document.getElementById("icost").value=m.prc_cost,document.getElementById("iunits").value=m.prc_units,document.getElementById("iprice").value=m.prc_price,document.getElementById("IPRICEKEY").value=t.prc_item_code+"|"+t.prc_effective_until;var y=new Date,p=y.getMonth()+1+"/"+y.getDate()+"/"+y.getFullYear();document.getElementById("ieffdt").value=p,document.getElementById("IAPEFFDT").value=p,document.getElementById("IAPEFFTYPE").value="T";var I=new Date(m.prc_effective);if(I.setDate(I.getDate()+2),y<I){var g=I.getMonth()+1+"/"+I.getDate()+"/"+I.getFullYear();document.getElementById("ieffdt").value=g,document.getElementById("IAPEFFDT").value=g,document.getElementById("IAPEFFTYPE").value="P"}var E="Item"+e,B=document.getElementById(E);B.parentNode.removeChild(B);var b=e+1,P="Del"+b;pNewDel=document.getElementById(P),pNewDel.innerHTML="<img src='MyImages/Icons/DeleteRedSM.png' style='height:13px; width:13px;' onclick='pDelSelected("+b+"); return(false);'>",iGlobalPrices.splice(e,1)}function pProcRollBack(e){return!1}function iShowHistory(e,t){for(var l=document.getElementById("ihistory").rows.length;6<l;)document.getElementById("ihistory").deleteRow(l-1),l--;if(iGetPurchases(e,t),iGetSales(e,t),0!=iGlobalPurchases.length||0!=iGlobalSales.length){document.getElementById("iapActFldset").style.display="inline";for(var i=0,n=0,a="N",d="",o="",s="";"N"==a;)o=i==iGlobalPurchases.length?"2000-01-01":iGlobalPurchases[i].purdet_date,s=n==iGlobalSales.length?"2000-01-01":iGlobalSales[n].sale_date,"2000-01-01"==o&&"2000-01-01"==s?a="Y":(s<o?(d=["P",iGlobalPurchases[i].purdet_purid,iGlobalPurchases[i].purdet_item,iGlobalPurchases[i].cat_description,iGlobalPurchases[i].purdet_date,iGlobalPurchases[i].purdet_quantity,iGlobalPurchases[i].purdet_cost,iGlobalPurchases[i].purdet_ext_cost,iGlobalPurchases[i].pur_vendor+"-"+iGlobalPurchases[i].pur_order,0,0],i+=1):o<s?(d=["S",iGlobalSales[n].saledet_sid,iGlobalSales[n].saledet_item_code,iGlobalSales[n].cat_description,iGlobalSales[n].sale_date,iGlobalSales[n].saledet_quantity,0,iGlobalSales[n].saledet_total_cost,iGlobalSales[n].cust_name+"-"+iGlobalSales[n].pe_sponsor,iGlobalSales[n].saledet_price,iGlobalSales[n].saledet_total_price],n+=1):iGlobalPurchases[i].purdet_item<iGlobalSales[n].saledet_item_code?(d=["P",iGlobalPurchases[i].purdet_purid,iGlobalPurchases[i].purdet_item,iGlobalPurchases[i].cat_description,iGlobalPurchases[i].purdet_date,iGlobalPurchases[i].purdet_quantity,iGlobalPurchases[i].purdet_cost,iGlobalPurchases[i].purdet_ext_cost,iGlobalPurchases[i].pur_vendor+"-"+iGlobalPurchases[i].pur_order,0,0],i+=1):(iGlobalPurchases[i].purdet_item>iGlobalSales[n].saledet_item_code||(d=["P",iGlobalPurchases[i].purdet_purid,iGlobalPurchases[i].purdet_item,iGlobalPurchases[i].cat_description,iGlobalPurchases[i].purdet_date,iGlobalPurchases[i].purdet_quantity,iGlobalPurchases[i].purdet_cost,iGlobalPurchases[i].purdet_ext_cost,iGlobalPurchases[i].pur_vendor+"-"+iGlobalPurchases[i].pur_order,0,0],i+=1,cPutHistoryOut(d)),d=["S",iGlobalSales[n].saledet_sid,iGlobalSales[n].saledet_item_code,iGlobalSales[n].cat_description,iGlobalSales[n].sale_date,iGlobalSales[n].saledet_quantity,0,iGlobalSales[n].saledet_total_cost,iGlobalSales[n].cust_name+"-"+iGlobalSales[n].pe_sponsor,iGlobalSales[n].saledet_price,iGlobalSales[n].saledet_total_price],n+=1),cPutHistoryOut(d))}else document.getElementById("iapActFldset").style.display="none"}function cPutHistoryOut(e){var t=document.getElementById("ihistory").insertRow(-1);t.setAttribute("class","iapTD1");var l=t.insertCell(0);l=t.insertCell(1);"P"==e[0]?l.innerHTML="<a href='?page_id=208&action=selected&pur="+e[1]+"'>Purchase</a>":l.innerHTML="<a href='?page_id=291&action=selected&sale="+e[1]+"'>Sale</a>",t.insertCell(2).innerHTML=moment(e[4]).format("MM/DD/YYYY"),t.insertCell(3).innerHTML=e[8];var i=t.insertCell(4);i.setAttribute("style","text-align:right;"),iItemQty=parseFloat(e[5]),i.innerHTML=number_format(iItemQty,0,".",",");var n=t.insertCell(5);n.setAttribute("style","text-align:right;"),iItemCost=parseFloat(e[6]),n.innerHTML=number_format(iItemCost,2,".",",");var a=t.insertCell(6);a.setAttribute("style","text-align:right;"),iItemTCost=parseFloat(e[7]),a.innerHTML=number_format(iItemTCost,2,".",",");var d=t.insertCell(7);d.setAttribute("style","text-align:right;"),iItemPrice=parseFloat(e[9]),d.innerHTML=number_format(iItemPrice,2,".",","),(o=t.insertCell(8)).setAttribute("style","text-align:right;"),iItemTPrice=parseFloat(e[10]),o.innerHTML=number_format(iItemTPrice,2,".",",");var o=t.insertCell(9)}function iGetPurchases(e,t){iapPrepCall("/Ajax/iapGetDB","PS",e,iProcPurchases)}function iProcPurchases(e){iGlobalPurchases=0!=e?e:[]}function iGetSales(e,t){iapPrepCall("/Ajax/iapGetDB","SS",t+"~"+e,iProcSales)}function iProcSales(e){iGlobalSales=0!=e?e:[]}function iClearForm(){document.getElementById("iDescList").value="",document.getElementById("iItemList").value="",document.getElementById("idetail").style.display="inline",document.getElementById("icode").value="",document.getElementById("idesc").value="",document.getElementById("iselcat").options.selectedIndex=0,document.getElementById("isupplier").value="",document.getElementById("ionhand").value="0",document.getElementById("iminonhand").value="0",document.getElementById("icost").value="0",document.getElementById("iunits").value="0",document.getElementById("iprice").value="0",document.getElementById("ieffdt").value="",document.getElementById("iapPrcFldset").style.display="none",document.getElementById("irollback").style.display="none",document.getElementById("irollback").style.display="none",document.getElementById("irollbackfill").style.display="none",document.getElementById("irollbackicon").style.display="none",document.getElementById("irollbacktxt").style.display="none",document.getElementById("iretirefill").style.display="none",document.getElementById("iretire").style.display="none";for(var e=document.getElementById("iapPriceChgs").rows.length;1<e;)document.getElementById("iapPriceChgs").deleteRow(e-1),e--;document.getElementById("iapActFldset").style.display="none";for(var t=document.getElementById("ihistory").rows.length;6<t;)document.getElementById("ihistory").deleteRow(t-1),t--;iGlobalItem=[],iGlobalPrices=[],iGlobalPurchases=[],iGlobalSales=[],document.getElementById("IUPDATETYPE").value="NEW",document.getElementById("IITEMCD").value="",document.getElementById("IPRICEKEY").value="",document.getElementById("IAPEFFDT").value="",document.getElementById("IAPEFFTYPE").value=""}$(function(){$("#iItemList").autocomplete({source:iItemCodes,minLength:0,change:function(e,t){if(t.item){var l=t.item.cd;i=t.item.src}else{if(""==(l=document.getElementById("iItemList").value))return document.getElementById("iSelError").innerHTML="Enter an item code or description then click Add Item!",void(document.getElementById("iSelError").style.display="inline");var i=0}iICodeClicked(l,i)}}),$("#iDescList").autocomplete({source:iItemDescs,minLength:0,change:function(e,t){t.item?iICodeClicked(t.item.cd,t.item.src):iIDescClicked(t=document.getElementById("iDescList").value,0)}})});