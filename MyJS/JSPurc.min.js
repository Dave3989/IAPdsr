var pGlblTotalNet=0;function pAddClicked(){pClearForm(),document.getElementById("PUPDATETYPE").value="NEW",document.getElementById("pdetail").style.display="block",document.getElementById("pPurDate").focus()}function pGoClicked(){}function pCheckPO(){return pPO=document.getElementById("pPurOrder").value,empty(pPO)||iapPrepCall("/Ajax/iapGetDB","PO",pPO,pChkPOReturn),!1}function pChkPOReturn(e){return e<0||(document.getElementById("pOrdNoExists").style.display=0==e?"none":"inline"),!1}function pProcPurchase(e){if(pClearForm(),e<0)return e;if(0==e)return document.getElementById("PUPDATETYPE").value="NEW",document.getElementById("POID").value="",e;document.getElementById("pPurDate").value=moment(e.pur_date).format("MM/DD/YYYY"),document.getElementById("pPurVendor").value=e.pur_vendor,document.getElementById("pPurOrder").value=e.pur_order,document.getElementById("pPurNet").value=number_format(e.pur_net,2,".",","),document.getElementById("pShipping").value=number_format(e.pur_shipping,2,".",","),document.getElementById("pSalesTax").value=number_format(e.pur_tax,2,".",","),document.getElementById("pPurMiles").value=number_format(e.pur_miles,2,".",","),document.getElementById("pPurExp").value=number_format(e.pur_expenses,2,".",","),document.getElementById("pExpExp").value=e.pur_exp_explained,document.getElementById("pComment").value=e.pur_comment;for(var t=e.purdtl,n=t.length,l=document.getElementById("iapReceived"),m=0;m<n;){var d=t[m].purdet_quantity*t[m].purdet_cost,r=l.insertRow(-1),o=r.insertCell(0),u=r.insertCell(1),c=r.insertCell(2),a=r.insertCell(3),I=r.insertCell(4),p=r.insertCell(5),i=r.insertCell(6);o.innerHTML="";var E=l.rows.length;r.setAttribute("id","Received"+E,0),o.innerHTML="<input type='hidden' id='recrow"+E+"' value='E'>",u.innerHTML="<img src='MyImages/Icons/DeleteRedSM.png' onclick='pDelReceived("+E+"); return(false);'>&nbsp;&nbsp;",c.innerHTML=t[m].purdet_item,a.innerHTML=t[m].purdet_desc,I.innerHTML=t[m].purdet_quantity,p.innerHTML=number_format(t[m].purdet_cost,2,".",","),i.innerHTML=number_format(d,2,".",",");var y=document.getElementById("PNEWITEMINFO").value;document.getElementById("PNEWITEMINFO").value=y+t[m].purdet_item+"~EXISTING~~~|",m+=1}document.getElementById("PUPDATETYPE").value="EXISTING",document.getElementById("POID").value=e.pur_id}function pSetUsePrice(){1==document.getElementById("pUsePrc").checked?document.getElementById("PUSEPRICE").value="Y":document.getElementById("PUSEPRICE").value=""}function pClrItemData(){return pClearItem(),document.getElementById("pItemCd").focus(),flase}function pClearItem(){document.getElementById("pItemCd").value="",document.getElementById("pItemDesc").value="",document.getElementById("pItemQty").value="",document.getElementById("pItemCost").value="",document.getElementById("pNewPrice").value="",document.getElementById("pNewUnits").value="",document.getElementById("pNewCat").selectedIndex=0}function pItemFocus(){""==document.getElementById("pPurDate").value&&pGenerateError("Please enter the Purchase Date before entering items.")}function pICodeClicked(e,t){if(""==document.getElementById("pPurDate").value)return pGenerateError("Please enter the Purchase Date before entering items."),!1;if(""!=e){"EXISTING"==document.getElementById("PTHISITEMSTATUS").value&&(document.getElementById("iapNewItem").style.display="none",pGenerateError("<RESET>"),document.getElementById("pItemDesc").value="");var n=(document.getElementById("PSUPPID").value=t)+"|"+e+"~"+document.getElementById("pPurDate").value;return iapPrepCall("/Ajax/iapGetDB","I#",n,pProcItem),!1}sGenerateError("Enter an item code or description then click Add Item!")}function pIDescClicked(){if(""==document.getElementById("pPurDate").value)return pGenerateError("Please enter the Purchase Date before entering items."),!1;if(pDesc=document.getElementById("pItemDesc").value,""!=pDesc){"EXISTING"==document.getElementById("PTHISITEMSTATUS").value&&(document.getElementById("iapNewItem").style.display="none",pGenerateError("<RESET>"),document.getElementById("pItemCd").value="");var e=pDesc+"~"+document.getElementById("pPurDate").value;return iapPrepCall("/Ajax/iapGetDB","IN",e,pProcItem),!1}sGenerateError("Enter an item code or description then click Add Item!")}function pProcItem(e){if("NEW"!=document.getElementById("PTHISITEMSTATUS").value)return 0==e?(pNIClicked(),pGenerateError("This item was not found. Please enter all the information below."),!1):void pProcItemGood(e);pProcNewItem(e)}function pProcItemGood(e){document.getElementById("pItemCd").value=e.cat_item_code,document.getElementById("pItemDesc").value=e.cat_description,"Y"==document.getElementById("PUSEPRICE").value?document.getElementById("pItemCost").value=number_format(e.prc_price,2,".",","):document.getElementById("pItemCost").value=number_format(e.prc_cost,2,".",","),"CO"==e.SUPPID?document.getElementById("PSUPPID").value=0:document.getElementById("PSUPPID").value=e.cat_supplier_id,document.getElementById("PTHISITEMSTATUS").value="EXISTING",document.getElementById("iapNewItem").style.display="none",document.getElementById("pItemQty").focus()}function pProcNewItem(e){0!=e&&pProcItemGood(e),e=document.getElementById("pItemCd").value,""!=document.getElementById("pItemCd").value?(pDesc=document.getElementById("pItemDesc").value,""!=pDesc?document.getElementById("pItemQty").focus():document.getElementById("pItemDesc").focus()):document.getElementById("pItemCd").focus()}function pNIClicked(){return""==document.getElementById("pItemCd").value?(pGenerateError("Enter the new item code then click Add."),document.getElementById("iapNewItem").style.display="block",document.getElementById("pItemCode").focus(),!1):(pGenerateError("<RESET>"),"none"==document.getElementById("iapNewItem").style.display?(document.getElementById("pItemQty").value="",document.getElementById("pItemCost").value="",document.getElementById("pNewUnits").value="",document.getElementById("pNewPrice").value="",document.getElementById("pNewCat").selectedIndex=0,document.getElementById("iapNewItem").style.display="block",document.getElementById("pItemDesc").focus(),!(document.getElementById("PTHISITEMSTATUS").value="NEW")):void 0)}function pRecordItem(){pGenerateError("<RESET>");var e="N";""==document.getElementById("pItemCd").value&&(document.getElementById("pItemCdLbl").style.color="red",pGenerateError("Item Code cannot be blank."),e="Y"),""==document.getElementById("pItemDesc").value&&(document.getElementById("pItemDescLbl").style.color="red",pGenerateError("Description cannot be blank."),e="Y"),""==document.getElementById("pItemQty").value&&(document.getElementById("pItemQtyLbl").style.color="red",pGenerateError("Quantity cannot be blank."),e="Y");var t=parseInt(document.getElementById("pItemQty").value);isNaN(t)&&(document.getElementById("pItemQtyLbl").style.color="red",pGenerateError("Quantity is invalid."),e="Y"),""==document.getElementById("pItemCost").value&&(document.getElementById("pItemCostLbl").style.color="red",pGenerateError("Cost cannot be blank."),e="Y");var n=parseFloat(document.getElementById("pItemCost").value);if(isNaN(n)&&(document.getElementById("pItemCostLbl").style.color="red",pGenerateError("Cost is invalid."),e="Y"),"NEW"==document.getElementById("PTHISITEMSTATUS").value){"N"==document.getElementById("IAPDL").value&&""==document.getElementById("pNewItem").value&&(document.getElementById("pNewItemLbl").style.color="red",pGenerateError("New Item Code cannot be blank."),e="Y"),""==document.getElementById("pNewUnits").value&&(document.getElementById("pNewUnitsLbl").style.color="red",pGenerateError("Saleable Units cannot be blank."),e="Y"),""==document.getElementById("pNewPrice").value&&(document.getElementById("pNewPriceLbl").style.color="red",pGenerateError("Selling Price cannot be blank."),e="Y");var l=parseFloat(document.getElementById("pNewPrice").value);isNaN(l)&&(document.getElementById("pNewPriceLbl").style.color="red",pGenerateError("Selling Price is invalid."),e="Y"),0==document.getElementById("pNewCat").selectedIndex&&(document.getElementById("pNewCatLbl").style.color="red",pGenerateError("Select a valid category for this item."),e="Y")}if("Y"==e)return pGenerateError("All item fields must be valid prior to clicking Record Item."),!1;if(pClearItemError(),"NEW"==document.getElementById("PTHISITEMSTATUS").value){var m=document.getElementById("pItemCd").value,d=document.createElement("option");document.getElementById("iapItemDL");d.value=m}else m=document.getElementById("pItemCd").value;t=parseInt(document.getElementById("pItemQty").value),n=parseFloat(document.getElementById("pItemCost").value);var r=parseFloat(t*n);pGlblTotalNet+=r;var o=document.getElementById("iapReceived"),u=o.insertRow(-1),c=u.insertCell(0),a=u.insertCell(1),I=u.insertCell(2),p=u.insertCell(3),i=u.insertCell(4),E=u.insertCell(5),y=u.insertCell(6),s=u.insertCell(7);c.innerHTML="";var g=o.rows.length-1;u.setAttribute("id","Received"+g,0);var B=document.getElementById("PTHISITEMSTATUS").value;B=B.substr(0,1),c.innerHTML="<input type='hidden' id='recrow"+g+" value='"+B+"'>",a.innerHTML="<img src='MyImages/Icons/DeleteRedSM.png' onclick='pDelReceived("+g+"); return(false);'>&nbsp;&nbsp;",I.innerHTML=m,p.innerHTML=document.getElementById("pItemDesc").value,i.innerHTML=t,E.innerHTML=number_format(n,2,".",","),y.innerHTML=number_format(r,2,".",","),document.getElementById("pPurNet").value=number_format(pGlblTotalNet,2,".",","),s.innerHTML=document.getElementById("PSUPPID").value;var v=document.getElementById("PNEWITEMINFO").value,P=m;"N"==document.getElementById("IAPDL").value&&(P=document.getElementById("pNewItem").value);var C=document.getElementById("pNewUnits").value,T=document.getElementById("pNewPrice").value,N=document.getElementById("pNewCat").value,b=document.getElementById("PTHISITEMSTATUS").value;return document.getElementById("PNEWITEMINFO").value=v+P+"~"+b+"~"+C+"~"+T+"~"+N+"~0|",pClearItem(),document.getElementById("PTHISITEMSTATUS").value="",document.getElementById("pItemCd").focus(),!1}function pDelReceived(e){var t="Received"+e,n=document.getElementById(t),l=n.cells,m=parseFloat(l[6].innerHTML),d=parseFloat(document.getElementById("pPurNet").value);return isNaN(d)&&(d=0),pGlblTotalNet-=m,document.getElementById("pPurNet").value=number_format(pGlblTotalNet,2,".",","),n.parentNode.removeChild(n),!1}function pClearForm(){document.getElementById("pPurList").value="",document.getElementById("pPurDate").value="",document.getElementById("pPurVendor").value="",document.getElementById("pPurOrder").value="",document.getElementById("pPurNet").value="",document.getElementById("pShipping").value="",document.getElementById("pSalesTax").value="",document.getElementById("pPurMiles").value="",document.getElementById("pPurExp").value="",document.getElementById("pExpExp").value="",document.getElementById("pComment").value="",pClearItem();for(var e=document.getElementById("iapReceived").rows.length;1<e;)document.getElementById("iapReceived").deleteRow(e-1),e--;return pGlblTotalNet=0,document.getElementById("PNEWITEMINFO").value="",!1}function pClearItem(){document.getElementById("pItemCd").value="",document.getElementById("pItemDesc").value="",document.getElementById("pItemQty").value="",document.getElementById("pItemCost").value="",document.getElementById("iapNewItem").style.display="none",document.getElementById("pNewUnits").value="",document.getElementById("pNewPrice").value="",pClearItemError()}function pClearItemError(){document.getElementById("pItemCdLbl").style.color="#666666",document.getElementById("pItemDescLbl").style.color="#666666",document.getElementById("pItemQtyLbl").style.color="#666666",document.getElementById("pItemCostLbl").style.color="#666666","N"==document.getElementById("IAPDL").value&&(document.getElementById("pNewItemLbl").style.color="#666666"),document.getElementById("pNewUnitsLbl").style.color="#666666",document.getElementById("pNewPriceLbl").style.color="#666666",document.getElementById("pNewCatLbl").style.color="#666666",pGenerateError("<RESET>")}function pSendForm(){if(""!=document.getElementById("pItemCd").value||""!=document.getElementById("pItemDesc").value)return pGenerateError("An Item has not been Recorded. Either click Record Item or clear the data."),document.getElementById("pItemCd").focus(),!1;for(var e="",t=document.getElementById("iapReceived"),n=1,l=t.rows.length;n<l;n++){for(var m=2,d=t.rows[n].cells.length;m<d;m++)e=e+t.rows[n].cells[m].innerHTML+"~";e+="|"}return document.getElementById("IAPDATA").value=e,!0}function pGenerateError(e){if("<RESET>"!=e){var t=document.getElementById("pItemError").innerHTML;document.getElementById("pItemError").innerHTML=t+"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+e}else document.getElementById("pItemError").innerHTML=" "}$(function(){$("#pPurList").autocomplete({source:pPrchList,minLength:0,change:function(e,t){if(""==document.getElementById("pPurList").value)document.getElementById("pError").style.display="block",document.getElementById("pPurList").focus();else{var n=t.item.id;document.getElementById("pError").style.display="none",iapPrepCall("/Ajax/iapGetDB","P#",n,pProcPurchase),document.getElementById("pdetail").style.display="block",document.getElementById("pPurDate").focus()}}}),$("#pPurVendor").autocomplete({source:pSplrList,minLength:0,change:function(e,t){""==document.getElementById("pPurVendor").value?(document.getElementById("PSUPPID").value=0,document.getElementById("UsePriceDiv").style.display="none"):(document.getElementById("PSUPPID").value=t.item.id,"Magnabilities LLC"==document.getElementById("pPurVendor").value&&(document.getElementById("UsePriceDiv").style.display="block"))}}),$("#pItemCd").autocomplete({source:pItemCodes,minLength:0,change:function(e,t){if(t.item){var n=t.item.cd;l=t.item.src}else{if(""==(n=document.getElementById("pItemCd").value))return void sGenerateError("Enter an item code or description then click Add Item!");var l=0}pICodeClicked(n,l)}}),$("#pItemDesc").autocomplete({source:pItemDescs,minLength:0,change:function(e,t){t.item?pICodeClicked(t.item.cd,t.item.src):pIDescClicked()}})});